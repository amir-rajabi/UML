<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False Detected Images</title>


    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.socket.io/3.0.3/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='node_modules/chart.js/dist/chart.umd.js') }}"></script>
<script src="{{ url_for('static', filename='node_modules/socket.io/client-dist/socket.io.js') }}"></script>
<script src="{{ url_for('static', filename='node_modules/bootstrap/dist/js/bootstrap.bundle.js') }}"></script>
<script src="{{ url_for('static', filename='node_modules/jquery/dist/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='node_modules/hammerjs/hammer.js') }}"></script>
<script src="{{ url_for('static', filename='node_modules/chartjs-plugin-zoom/dist/chartjs-plugin-zoom.min.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/dia.js') }}" ></script>
<script type="module" src="{{ url_for('static', filename='a_js/navigate.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/adjust.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/send.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/onload.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/draw.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/reset.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/alerts.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/tooltip.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/models.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/history.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/help.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='a_js/keyboard.js') }}"></script>

<script type="module" src="static/a_js/send.js"></script>
<script type="module" src="static/a_js/onload.js"></script>






</head>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<body style="background-color: #202124; color: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';">

    <a href="http://127.0.0.1:5001/" class="btn btn-outline-light" style="position: absolute; top: 10px; left: 10px;">Go to First Page</a>

        <div class="centered-box">
            <div style="text-align: center;">
        <h1 style="font-size: 34px;margin-top: 40px; margin-bottom: 20px;">{{ total_images }} False Detected Images</h1>

<div style="text-align: center; display: flex; justify-content: space-around; height: 70vh; margin-top: 40px;">

<div id="message-container" style="position: fixed; top: 70px; right: 20px; z-index: 1000;"></div>


    <!-- Container for Image and Navigation Buttons -->
  <div class="centered-box-small">

    <img src="{{ detection['image'] }}" alt="False Detected Image" style="display: block; margin: 0 auto; max-width: 90%; max-height: 70%; border-radius: 10px; border: 2px solid white;">

    <!-- Image Info -->
    <div class="image-info">
        <p style="margin-bottom: 20px; font-size: 20px; margin-top: 20px; margin-left: 10px">Image {{ session['current_index'] + 1 }}</p>
        <p style="margin-bottom: 20px; font-size: 20px;margin-left: 10px">Label: {{ detection['label'] }}</p>
        <p style="margin-bottom: 20px; font-size: 20px;margin-left: 10px">Prediction: {{ detection['prediction'] }}</p>
    </div>

    <!-- Navigation buttons -->
    <div class="navigation-buttons" style="display: flex; justify-content: space-between;">
        <form action="/fdi" method="post" onsubmit="showLoadingMessage();">
            {% if session['current_index'] > 0 %}
                <button type="submit" name="previous" style="width: 90px;" class="btn btn-outline-light">Previous</button>
            {% endif %}
        </form>

        <form action="/fdi" method="post" onsubmit="showLoadingMessage();">
            {% if session['current_index'] < total_images - 1 %}
                <button type="submit" name="next" style="width: 90px;" class="btn btn-outline-light">Next</button>
            {% endif %}
        </form>
    </div>


</div>


    <!-- Container for Image Info and Label Modification -->
    <div class="centered-box-small">
    <div>

       {% if detection.get('actual_label') is not none and detection['actual_label']|string != detection['label']|string %}
            <p style="margin-top: 20px; font-size: 20px;color:green">Modified Label:{{ detection['actual_label'] }}</p>
        {% else %}
    <p style="margin-top: 20px; font-size: 20px; color: white">Modified Label: <span style="color:white">-</span></p>
        {% endif %}
            <!-- Input for new label -->
            <form action="/change_label" method="post" onsubmit="showLoadingMessage();" class="d-flex flex-column align-items-center">
    <div class="d-flex align-items-center">
        <label for="new_label" class="mr-2" style="font-size: 20px;">New Label:</label>
        <select id="new_label" name="new_label" class="btn btn-info dropdown-toggle" style="font-size: 20px;">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
        </select>
    </div>
<div style="margin-top: 20px; margin-bottom: 5px;">
                    <button type="submit" class="btn btn-outline-light" style="width: 139px;">Change Label</button>
                </div>
            </form>
<a onclick="startBetaTraining();" class="btn btn-outline-light">Update Training</a>

            <!-- Separate form for clearing modifications -->
            <form id="clear-modifications-form" action="/clear_modifications" method="post" onsubmit="showLoadingMessage();" style="align-items: center;">
                <div style="margin-top: 170px;">
                    <button type="submit" class="btn btn-outline-danger">Undo all Changes</button>
                </div>
            </form>
        </div>
    </div>

    </div>
                <div id="visual-lower-ctr">
    <div id="visual-lower">
        <div class="progress" id="progress" role="progressbar" aria-label="Animated striped example" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar progress-bar-striped progress-bar-animated" id="progress-bar"></div>
        </div>

    </div>

</div>
        </div>
    </div>

    </div>

    <style>

#message-container {
  position: fixed;
  top: 70px;
  right: 20px;
  font-size: 1.2em;
  z-index: 100;
  min-height: 700px;
}


.button-container {
    display: flex;
    justify-content: space-between; /* Adjust the spacing between the buttons as you need */
    align-items: center;
}

 .centered-box-small {
    display: flex;
    flex-direction: column; /* This stacks children vertically */
    align-items: flex-start; /* Aligns items to the top */
    background-color: #202124;
    padding: 20px;
    border-radius: 10px;
    width: 45%; /* Adjust if needed */
    height: 80%; /* Adjust if needed */
    min-height: 200px; /* You can adjust this value */
    min-width: 200px; /* You can adjust this value */
    overflow: auto; /* This should help with the zooming issue */
}

.centered-box-small div {
    width: 100%;
    text-align: left;
}
.image-info {
    text-align: left;
    margin-bottom: 15px;
}

    .centered-box {
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #333A4A;
    padding: 40px;
    border-radius: 100px;
    margin: 2vh auto;
    width: 44%; /* You can adjust this as needed */
    height: 10%; /* You can adjust this as needed */
}

        .button {
            display: inline-block;
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            outline: none;
            color: black;
            background-color: white;
            border: none;
            border-radius: 15px;
            margin: 5px;
            width: 150px; /* ensure that both buttons are of equal width */
        }

        .action-button {
            display: inline-block;
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            outline: none;
            color: black;
            background-color: white;
            border: none;
            border-radius: 15px;
            margin: 5px;
            width: 180px; /* set width for action buttons */
        }

        .button:hover, .action-button:hover {
            background-color: lightgray
        }

        .button:active, .action-button:active {
            background-color: lightgray;
        }

       select {
         color: black;
         margin: 0 5px;
        }
       label {
         color: white;
         margin: 0 5px;
       }
        select option {
        color: black;
        }
    </style>

  <script>
    var socket = io.connect('http://127.0.0.1:5001');  // adjust the URL as needed

    socket.on('percent', function(data) {
        var percentage = data.percent;
        $('#progress-bar').css('width', percentage + '%').attr('aria-valuenow', percentage);
    });


function startBetaTraining() {
    $.ajax({
        url: '/start_beta',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({}),
        dataType: 'json',
        success: function(response) {
            console.log('Request succeeded with response:', response);
            window.location.href = 'http://127.0.0.1:5001';
        },
        error: function() {
            alert("There was a problem communicating with the server. Please try again.");
        }
    });
}



function showAlert(message, alertType) {
    const alertTemplate = `
        <div class="alert alert-${alertType} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>`;

    document.getElementById('message-container').insertAdjacentHTML('beforeend', alertTemplate);

    setTimeout(() => {
        document.querySelector('#message-container .alert').remove();
    }, 5000); // This value is in milliseconds, adjust to change the display time
}



$(document).ready(function(){
            // Ajax submission for change_label form
            $("form[action='/change_label']").submit(function(e){
                e.preventDefault(); // Prevent the default form submission
                $.post($(this).attr('action'), $(this).serialize(), function(response){
                    if(response.status === "success"){
                        showAlert(response.message, response.alertType);
                        setTimeout(function(){
                             location.reload();
                        }, 1500);


                    } else {
                        showAlert(response.message, response.alertType);
                        setTimeout(function(){
                             location.reload();
                        }, 1500);
                    }
                }).fail(function() {
                    showAlert("There was a problem communicating with the server. Please try again.", "danger");
                });
            });

            // Ajax submission for clear_modifications form
            $("#clear-modifications-form").submit(function(e){
                e.preventDefault(); // Prevent the default form submission
                $.post($(this).attr('action'), $(this).serialize(), function(response){
                if(response.status === "success"){
                   showAlert(response.message, response.alertType);
                   setTimeout(function(){
                             location.reload();
                        }, 1500);
                }
                }).fail(function() {
                 showAlert("There was a problem communicating with the server. Please try again.", "danger");
                });

            });
        });
</script>
</body>

</html>

